<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title></title>
	<link rel="stylesheet" href="">
</head>
<body>
	<input type="text" name="ville">
	<ul class="result"></ul>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
	<script>
		var departement = new Array();
		var filter = {
			defaults : {
				result : '',
				file : '',
				category : '',
				initialized : function(){}
			},
			init : function(options){
				this.params=$.extend(this.defaults,options);
				this.initialize();
			},
			/*getJsonFile : function(){
				var self = this.params;
				$.getJSON(this.params.file, function(result){
					$.each(result, function(index, value){
				    	self.tab.push(value[self.category].toLowerCase());
				    });
				    self.gotJsonFile.call(this, null);
				});
			},*/
			compare: function(a, b){
				return a[2] < b[2];
			},
			initialize : function(){
				var self = this;
				$('.result').empty();
				var result = new Array();
				var data = JSON.parse(localStorage.getItem(self.params.category));
				$.each(data, function(index, value){
					data[index].minuscule = value['nom'].toLowerCase();
					//console.log(data['nom']);
				});
				self.params.initialized.call(this, data);
			},
			render:function(data, search, maxOccurrence){
				$('.result').empty();
				var result = new Array();
				if(search.length>1){
					$.each(data, function(index, value){
						var occurrence = value.minuscule.search(new RegExp(search.toLowerCase()));
						if(occurrence!=-1)
							result.push(new Array(value.nom, value.url, value.code, occurrence));
					});
					result.sort(function(a, b) { return a[3]>b[3] }); 
					var ul = $('.result');
					for(i=0; i<result.length; i++){
						if(i==maxOccurrence)
							return;
						$('<li>'+result[i][0]+'</li>').appendTo(ul);
					}
				}
				
			}
		};

		filter.init({
			result: '.result',
			file : 'departement.json',
			tab : departement,
			category : 'departements',
			initialized : function(data){
				$('input[type="text"]').on('keyup',function(e){
					filter.render(data, $(this).val(), 3);
				});
			}
		});

	</script>
</body>
</html>